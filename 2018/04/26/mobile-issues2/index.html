<!DOCTYPE html><html class="fixed-top" lang="zh-cn"><head><link rel=manifest href=/manifest.json><meta charset="UTF-8"><meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Blog PWA"><link rel="apple-touch-icon" href="images/icons/icon-152x152.png"><meta name="msapplication-TileImage" content="images/icons/icon-144x144.png"><meta name="msapplication-TileColor" content="#2F3BA2"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?50461fe435ccda0fde8858f08eae2050";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><title>那些移动端web踩过的坑2 [ 牧羊少年的个人博客 ]</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/media.css"><link rel="icon" href="/favicon.ico"></head><body><div id="menu-outer"><dev class="bd-special-shadow" id="specialShadow" style="transform: scaleY(1);"></dev><nav class="container" id="menu-inner"><div class="navbar-brand"><a class="navbar-item" href="#"><img src="/images/avatar.png" alt="头像"><span>牧羊少年</span></a><div class="navbar-burger" id="navbarBurger"><span></span><span></span><span></span></div></div><div class="navbar-menu" id="navMenuIndex"><div class="navbar-start"><div class="navbar-item"><a class="navbar-link" href="/">首页</a></div><div class="navbar-item"><a class="navbar-link active" href="/archives">归档</a></div><div class="navbar-item"><a class="navbar-link" href="/about">关于</a></div></div></div></nav></div><div id="content-outer"><div class="content" id="content-inner"><div class="post-wrap"><article class="post" id="post"><div class="post-header"><h1 class="post-title">那些移动端web踩过的坑2</h1></div><div class="post-meta"><div class="tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/">mobile</a></li></ul></div><time datetime="2018-04-26T09:20:41.000Z">2018-04-26</time></div><section class="post-content"><p>坑是无穷无尽的，嗯…长江后坑推前坑~~<br><a id="more"></a></p>
<h3 id="关于音频自动播放"><a href="#关于音频自动播放" class="headerlink" title="关于音频自动播放"></a>关于音频自动播放</h3><p>H5的audio标签实现了浏览器端的音频播放可能性，虽然目前的手机浏览器也都支持这个标签和相关属性，但不同的手机对其表现行为还是五花八门，而且有的时候还和客户端那边的音频控制相关。这次遇到了一个问题是iOS中无法自动播放音频（autoplay无效，目测他们是考虑了流量问题吧），解决方法也还好，一般如果是微信里，可以使用他们自带的一个事件来解决。不过需要先引入他们的js：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;//res.wx.qq.com/open/js/jweixin-1.0.0.js&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>然后在ready之后监听一个微信定义特殊的事件WeixinJSBridgeReady：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"WeixinJSBridgeReady"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'bgm'</span>).play(); </span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></p>
<p>如果是Safari这种，基本上就是通过交互来解决了，比如让用户第一次触摸的时候播放音乐<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).one(<span class="string">'touchstart'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'bgm'</span>).play(); </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="关于软键盘问题"><a href="#关于软键盘问题" class="headerlink" title="关于软键盘问题"></a>关于软键盘问题</h3><p>H5页面中的输入框，输入框focus的时候就会弹出软键盘，失去焦点的时候键盘消失。其实正常来讲都还好，只是有的时候软键盘可能把输入框挡住，或者按钮挡住，这个倒不算什么大问题，这次令人头疼的是某些奇葩安卓机，如果使用了绝对定位或者fixed，软键盘弹出来的时候把页面往上推，推的下面出来一大块空白特别丑~这里的解决方法其实也很简单<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'body'</span>).height($(<span class="string">'body'</span>)[<span class="number">0</span>].clientHeight);</span><br></pre></td></tr></table></figure></p>
<p>还有一些更奇葩的安卓手机，软键盘出来的时候把页面顶上去，消失的时候把页面往下拉，又拉出一大片空白区域，需要手动上滑一下才正常。这里试了好多方法，最后找到了一个还算可以解决的,需要找到那个被拉下来的相关元素，然后执行scrollIntoView()方法即可，<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = <span class="built_in">document</span>.querySelector(<span class="string">'input'</span>)</span><br><span class="line">input.addEventListener(<span class="string">'blur'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        $(<span class="string">'.the-element'</span>)[<span class="number">0</span>].scrollIntoView(); </span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>关于scrollIntoView的用法:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">element.scrollIntoView(); </span><br><span class="line"><span class="comment">//不显示声明任何参数，则相当于是element.scrollIntoView(true) </span></span><br><span class="line"> </span><br><span class="line">element.scrollIntoView(alignToTop); </span><br><span class="line"><span class="comment">//Boolean类型参数 </span></span><br><span class="line"><span class="comment">//如果为 true，则元素的顶部将尽可能滚动到与父元素可见区域顶部对齐的位置，这是默认值。</span></span><br><span class="line"><span class="comment">//如果为 false，则元素的底部将尽可能滚动到与父元素可见区域底部对齐的位置 </span></span><br><span class="line"> </span><br><span class="line">element.scrollIntoView(scrollIntoViewOptions); </span><br><span class="line"><span class="comment">//Object类型参数 </span></span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">behavior: <span class="string">'auto'</span> | <span class="string">'instant'</span> | <span class="string">'smooth'</span>, </span><br><span class="line">block: <span class="string">'start'</span> | <span class="string">'end'</span> </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//behavior：定义了元素滚动的行为，instant代表是立即滚动元素，smooth代表动画性的平滑滚动，但大部分浏览器并不支持smooth这个属性值，一般都是 instant。 </span></span><br><span class="line"><span class="comment">//block：定义了元素滚动的方向，对应Boolean类型参数，如果设置了start值，则相当于是设置了element.scrollIntoView(true)，如果设置了end值，则相当于是设置了element.scrollIntoView(false)，</span></span><br></pre></td></tr></table></figure></p>
<p>嗯，多学习吧~~长路漫漫！</p>
</section></article></div></div></div><div id="bottom-outer"><div id="bottom-inner"><span>Site construction by</span><span> 牧羊少年 </span><span>using</span><a href="http://hexo.io"><span>hexo blog framework</span></a><span>.</span></div></div><script>window.is_home = false</script><script src="/js/resLoader.js"></script><script src="/js/main.js"></script><script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js?t=1524810659297')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body></html>