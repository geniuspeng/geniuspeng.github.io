<!DOCTYPE html><html class="fixed-top" lang="zh-cn"><head><link rel=manifest href=/manifest.json><meta charset="UTF-8"><meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Blog PWA"><link rel="apple-touch-icon" href="images/icons/icon-152x152.png"><meta name="msapplication-TileImage" content="images/icons/icon-144x144.png"><meta name="msapplication-TileColor" content="#2F3BA2"><title>简单的图片查看器（缩放和拖动） [ 牧羊少年的个人博客 ]</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/media.css"><link rel="icon" href="/favicon.ico"></head><body><div id="menu-outer"><dev class="bd-special-shadow" id="specialShadow" style="transform: scaleY(1);"></dev><nav class="container" id="menu-inner"><div class="navbar-brand"><a class="navbar-item" href="#"><img src="/images/avatar.png" alt="头像"><span>牧羊少年</span></a><div class="navbar-burger" id="navbarBurger"><span></span><span></span><span></span></div></div><div class="navbar-menu" id="navMenuIndex"><div class="navbar-start"><div class="navbar-item"><a class="navbar-link" href="/">首页</a></div><div class="navbar-item"><a class="navbar-link active" href="/archives">归档</a></div><div class="navbar-item"><a class="navbar-link" href="/about">关于</a></div></div></div></nav></div><div id="content-outer"><div class="content" id="content-inner"><div class="post-wrap"><article class="post" id="post"><div class="post-header"><h1 class="post-title">简单的图片查看器（缩放和拖动）</h1></div><div class="post-meta"><div class="tags"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul></div><time datetime="2015-05-16T07:53:27.000Z">2015-05-16</time></div><section class="post-content"><p>最近参加了360的一个校招，然后留了这么个作业<br><img src="http://7xj4f4.com1.z0.glb.clouddn.com/360homework.png" alt="img"><br>作为一只前端菜鸟，我的第一反应是：啊 写个简历吧，反正以后找工作也能用上…然后我就写。 。 。 我就写。 。 。 然后发现问题了：<br><a id="more"></a></p>
<ol>
<li>这尼玛，网页上做简历跟在word上做能做出啥区别来么？交互又是什么GUI？再怎么做不都是把文字直接往里贴么。。。而且我还是用markdown写的，完全木有技术含量啊。。。会打字的都能做出来~这是我忽然想到了以前看过的一个学长的主页，用了一个看似很炫酷的东西做的关于自我简介的力学图。。。于是问了下群里的大神，告诉我用D3做的，感觉这个是个交互的东西而且感觉逼格挺高的呵，于是乎上网查了下······这尼玛这API给我几个月也记不全，好在我只想用一部分，就把力学图那里简单学了下，折腾2个晚上总算是做出来个东西，但是做出来之后感觉放到我用markdown写的那个简历（就是主页的about页面）里太特么不合群了（凭啥我们都不会动就你会动，凭啥就你能交互- -），所以就没扔进去，放在博客的<a href="http://locusland.xyz/" target="_blank" rel="noopener">Home主页</a>了- -</li>
<li>由于本科水过来的，硕士还是水过来的，简历上确实写不出神马好东西来，无非也就是吹吹NB败败火只当看个乐呵···还是做个图片查看器那个好了。。。<br>要说这个要求，一个缩放，一个拖拽，我印象中用jQuery的话，几行代码松松搞定的。。。不过毕竟是个菜鸟，用jQuery想必还不如不做，对自己也没什么提高，还是要注重基础，基础嗯。。。所以得用原生的JS做，顺便熟悉一下那些事件。</li>
</ol>
<p>##关于缩放<br>这个没啥好说的，一般都是2个按钮，一个放大一个缩小，直接控制图片的<code>height</code>和<code>width</code>属性就可以了，或者用zoom属性来控制，点一下大一些或者小一些(不要问为神马用1.2)，咳咳咳。。。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function larger()&#123;//两种方式，可以用width和height，也可以用zoom来控制</span><br><span class="line">    var w = image.width;</span><br><span class="line">    var h = image.height;</span><br><span class="line">    image.width = w * 1.2;</span><br><span class="line">    image.height = h * 1.2;</span><br><span class="line">    // image.style.zoom = parseFloat(image.style.zoom) + 0.1;</span><br><span class="line">&#125;</span><br><span class="line">function smaller()&#123;//同larger</span><br><span class="line">    var w = image.width;</span><br><span class="line">    var h = image.height;</span><br><span class="line">    image.width = w / 1.2;</span><br><span class="line">    image.height = h / 1.2;</span><br><span class="line">    // image.style.zoom = parseFloat(image.style.zoom) - 0.1;</span><br><span class="line">    // if(image.style.zoom &lt; 0.1) return</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后一般都会带个滚轮来缩放吧，就是onmousewheel这个事件和wheelDelta这个属性来控制图片大小的问题，也是两种形式（宽高或者zoom属性），反正我是这么写的(据说FireFox浏览器木有wheelDelta这个属性，而是detail，关于浏览器兼容这些，就当外部已经处理好了吧，不要在意这些细节)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">image.onmousewheel = function(e)&#123; //也是两种方式</span><br><span class="line">    e = e || window.event; </span><br><span class="line">    var w = image.width;</span><br><span class="line">    var h = image.height;</span><br><span class="line">    image.width = e.wheelDelta&gt;0 ? w * 1.2 : w / 1.2;</span><br><span class="line">    image.height = e.wheelDelta&gt;0 ? h * 1.2 : h / 1.2;</span><br><span class="line">    // zoom = parseFloat(this.style.zoom);</span><br><span class="line">    // curZoom = zoom + (e.wheelDelta&gt;0 ? 0.05 : -0.05);	</span><br><span class="line">    // if(curZoom &lt; 0.1) return</span><br><span class="line">    // this.style.zoom=curZoom;</span><br><span class="line">    // return;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>##关于拖动<br>拖动的功能，在以前做项目的时候就遇到过，不过都是网上搜的代码直接用的，不过仔细分析一下原理，也不是很复杂，尤其是单纯滴拖个图片放到另一个位置，那更简单了<br>好吧做这个功能还真发现了奇怪的东西，就是说如果你的图片的<code>top</code>和<code>left</code>属性是通过外部css引入的，或者是style标签引入的，在js里直接要获取，它会很傲娇，不给你值，当然一般情况不会把一张图片摆在那进行操作（那时候你可以new Image（）嘛），我这只是个简单的图片的查看器，所以就简单起来了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;div&quot; style=&quot;position:absolute;top: 50px;left: 0px;&quot;&gt;</span><br><span class="line">	&lt;img draggable=&quot;true&quot; style=&quot;zoom: 1.0;position: absolute;top: 50px;left: 50px;cursor:move;visibility:visible&quot; id=&quot;image&quot; src=&quot;http://7xj4f4.com1.z0.glb.clouddn.com/test.jpg&quot; alt=&quot;大家好我是测试图片&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>简单的情况自然有简单的处理方法，直接加style属性，这样就可以直接获取他的top和left属性了。至于我为什么要加一个div，其实一开始直接用图片image来定位的，但是做出来之后，缩小之后的图片进行拖拽的时候，鼠标移动速度要比图片移动速度快，造成不同步了，而正常情况下图片也都不是单独存在的，这里就用div的style来进行图片的定位。<br>而拖动的原理就是。。。。。。简单的定位</p>
<p>#####如果不用HTML5<br>那就是onmousedown，onmousemove，onmouseup这几个事件配合一下了，弄个<code>flag=false</code>代表是否可拖动(初始为不可拖动状态)：<br><strong>onmousedown</strong>：初始化一下，让<code>flag=true</code>，然后记录下此时的图片的top和left值，同时记录下此时的clientX和clientY（就是鼠标位置距离浏览器上边喝左边的距离，不算滚动条，我这里记为left_before和top_before）<br><strong>onmousemove</strong>：动态改变图片的top和left，怎么改变呢…首先要随时获取当前的clientX和clientY，减去初始化时获取的clientX和clientY（就是left_before和top_before），其实就是鼠标拖动的水平和垂直距离，再加上初始化时候的left和top，就是当前的left和top…还是很好理解的，这里在移动过程中要随时return，否则它拖一小段距离就罢工了<br><strong>onmouseup</strong>：拖动结束鼠标松开的时候触发，需要做的只是把flag设置为false，让其变回不可拖动状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">image.onmousedown = function(e) &#123;</span><br><span class="line">    e = e || window.event;</span><br><span class="line">    drag_flag = true;</span><br><span class="line">    left_init = parseInt(div.style.left);</span><br><span class="line">    top_init = parseInt(div.style.top);</span><br><span class="line">    console.log(left_init);</span><br><span class="line">    left_before = e.clientX;</span><br><span class="line">    top_before = e.clientY;</span><br><span class="line">&#125; </span><br><span class="line">image.onmousemove =  function(e) &#123;</span><br><span class="line">    e = e || window.event;</span><br><span class="line">    if(drag_flag)&#123;</span><br><span class="line">        div.style.top  =  (e.clientY - top_before + top_init)+&quot;px&quot;;</span><br><span class="line">        div.style.left = (e.clientX - left_before + left_init) +&quot;px&quot;;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;	</span><br><span class="line">&#125; </span><br><span class="line">image.onmouseup = function(e) &#123;</span><br><span class="line">    e = e || window.event;</span><br><span class="line">    drag_flag = false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>#####如果用HTML5<br>其实H5有个drag，专门处理拖动的，不过对于这种简单的图片拖动，其实是没有什么区别的，在这里，我要无耻地盗一张图<br><img src="http://7xj4f4.com1.z0.glb.clouddn.com/h5drag.png" alt="img"><br>看完这个，其实相对于之前mouse的3个事件，对应的是dragstart,dragover,drop三个事件，不过要注意下，首先要先设置个<code>draggable=&quot;true&quot;</code>,然后dragover和drop都是针对目标对象的，不是图片本身，而是图片落下的那个地方，其实在我这里就是body了,那么就可以这样写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">image.ondragstart = function(e) &#123;</span><br><span class="line">    e = e || window.event;</span><br><span class="line">    drag_flag = true;</span><br><span class="line">    left_init = parseInt(div.style.left);</span><br><span class="line">    top_init = parseInt(div.style.top);</span><br><span class="line">    console.log(left_init);</span><br><span class="line">    left_before = e.clientX;</span><br><span class="line">    top_before = e.clientY;</span><br><span class="line">&#125; </span><br><span class="line">document.ondrop = function(e) &#123;</span><br><span class="line">    e = e || window.event;</span><br><span class="line">    drag_flag = false;</span><br><span class="line">&#125;</span><br><span class="line">document.ondragover = function(e) &#123;</span><br><span class="line">    e = e || window.event;</span><br><span class="line">    if(drag_flag)&#123;</span><br><span class="line">        div.style.top  =  (e.clientY - top_before + top_init)+&quot;px&quot;;</span><br><span class="line">        div.style.left = (e.clientX - left_before + left_init) +&quot;px&quot;;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其实，H5的这个drag用在这里感觉挺浪费的，因为感觉做不出什么区别来- -拖拽的一些其他复杂实现感觉用这个比mouse事件要来得方便得多~~~<br>关于图片处理，CSS还可以实现平移，旋转，翻转，以及各种滤镜。。。不过题目也没要求，而且只是为了感悟下拖动的原理，所以就酱吧<br>虽然是很简单的东西，不过要想原生实现，其实还是会发现很多问题的，而且我这里没有考虑太多了浏览器兼容问题，都说了只是为了感悟一下拖动的原理= =还是，基础，要基础啊，前辈们说滴还是很有道理的，用别人的东西用10次也不如自己写一次！</p>
</section></article></div></div></div><div id="bottom-outer"><div id="bottom-inner"><span>Site construction by</span><span> 牧羊少年 </span><span>using</span><a href="http://hexo.io"><span>hexo blog framework</span></a><span>.</span></div></div><script>window.is_home = false</script><script src="/js/resLoader.js"></script><script src="/js/main.js"></script><script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js?t=1514522006084')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body></html>